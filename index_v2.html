<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Somnia Minesweeper V2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .wallet-info {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .difficulty-selection {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
            min-width: 400px;
        }
        
        .difficulty-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .difficulty-card {
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            border: 2px solid transparent;
        }
        
        .difficulty-card:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }
        
        .difficulty-card.selected {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.3);
        }
        
        .difficulty-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        .difficulty-info {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .game-info {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .info-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            min-width: 80px;
            text-align: center;
            backdrop-filter: blur(10px);
            flex: 1;
        }
        
        .info-card div:first-child {
            font-size: 0.85em;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .info-card div:last-child {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .stats-section {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
            max-width: 800px;
        }
        
        .stats-grid {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .game-board {
            display: grid;
            gap: 2px;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 10px;
            margin: 20px 0;
            max-width: 90vw;
            overflow: auto;
        }
        
        .tile {
            background: #c0c0c0;
            border: 2px solid #808080;
            border-top-color: white;
            border-left-color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            user-select: none;
            min-width: 25px;
            min-height: 25px;
            font-size: 12px;
        }
        
        .tile:hover {
            background: #d0d0d0;
        }
        
        .tile.revealed {
            background: #e0e0e0;
            border: 1px solid #808080;
        }
        
        .tile.flagged {
            background: #ff6b6b;
            color: white;
        }
        
        .tile.mine {
            background: #ff4757;
            color: white;
        }
        
        .tile.number-1 { color: #0074cc; }
        .tile.number-2 { color: #228b22; }
        .tile.number-3 { color: #ff6347; }
        .tile.number-4 { color: #800080; }
        .tile.number-5 { color: #8b0000; }
        .tile.number-6 { color: #2e8b57; }
        .tile.number-7 { color: #000; }
        .tile.number-8 { color: #808080; }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px 0 rgba(31, 38, 135, 0.2);
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(31, 38, 135, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .status-message {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        /* Î∞òÏùëÌòï ÌÉÄÏùº ÌÅ¨Í∏∞ */
        .board-easy { 
            grid-template-columns: repeat(9, 35px);
            grid-template-rows: repeat(9, 35px);
        }
        .board-easy .tile { width: 35px; height: 35px; font-size: 14px; }
        
        .board-medium { 
            grid-template-columns: repeat(16, 25px);
            grid-template-rows: repeat(16, 25px);
        }
        .board-medium .tile { width: 25px; height: 25px; font-size: 12px; }
        
        .board-hard { 
            grid-template-columns: repeat(30, 20px);
            grid-template-rows: repeat(16, 20px);
        }
        .board-hard .tile { width: 20px; height: 20px; font-size: 10px; }
        
        @media (max-width: 768px) {
            .difficulty-options {
                flex-direction: column;
                align-items: center;
            }
            
            .board-hard { 
                grid-template-columns: repeat(30, 15px);
                grid-template-rows: repeat(16, 15px);
            }
            .board-hard .tile { width: 15px; height: 15px; font-size: 8px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚õèÔ∏è Somnia Minesweeper V2</h1>
        <p>Blockchain-powered Minesweeper with Multiple Difficulties</p>
    </div>
    
    <div class="wallet-info">
        <div id="walletStatus">
            <button class="btn" onclick="connectWallet()">Connect Wallet</button>
        </div>
    </div>
    
    <div class="difficulty-selection" id="difficultySelection">
        <h3>üéØ ÎÇúÏù¥ÎèÑ ÏÑ†ÌÉù</h3>
        <div class="difficulty-options">
            <div class="difficulty-card" data-difficulty="0" onclick="selectDifficulty(0)">
                <div class="difficulty-title">üü¢ Ï¥àÍ∏â</div>
                <div class="difficulty-info">9√ó9<br>10Í∞ú ÏßÄÎ¢∞<br>0.0005 ETH</div>
            </div>
            <div class="difficulty-card selected" data-difficulty="1" onclick="selectDifficulty(1)">
                <div class="difficulty-title">üü° Ï§ëÍ∏â</div>
                <div class="difficulty-info">16√ó16<br>40Í∞ú ÏßÄÎ¢∞<br>0.001 ETH</div>
            </div>
            <div class="difficulty-card" data-difficulty="2" onclick="selectDifficulty(2)">
                <div class="difficulty-title">üî¥ Í≥†Í∏â</div>
                <div class="difficulty-info">16√ó30<br>99Í∞ú ÏßÄÎ¢∞<br>0.002 ETH</div>
            </div>
        </div>
    </div>
    
    <div class="stats-section">
        <h3>üìä ÌîåÎ†àÏù¥Ïñ¥ ÌÜµÍ≥Ñ</h3>
        <div class="stats-grid">
            <div class="info-card">
                <div>Ï¥ù Ï†êÏàò</div>
                <div id="totalScore">0</div>
            </div>
            <div class="info-card">
                <div>Ï¥ù ÏäπÎ¶¨</div>
                <div id="totalWins">0</div>
            </div>
            <div class="info-card">
                <div>Ï¥àÍ∏â ÏäπÎ¶¨</div>
                <div id="easyWins">0</div>
            </div>
            <div class="info-card">
                <div>Ï§ëÍ∏â ÏäπÎ¶¨</div>
                <div id="mediumWins">0</div>
            </div>
            <div class="info-card">
                <div>Í≥†Í∏â ÏäπÎ¶¨</div>
                <div id="hardWins">0</div>
            </div>
        </div>
    </div>
    
    <div class="game-info" id="gameInfo" style="display: none;">
        <div class="info-card">
            <div>ÎÇúÏù¥ÎèÑ</div>
            <div id="currentDifficulty">Ï§ëÍ∏â</div>
        </div>
        <div class="info-card">
            <div>ÎÇ®ÏùÄ ÏßÄÎ¢∞</div>
            <div id="minesLeft">40</div>
        </div>
        <div class="info-card">
            <div>ÏãúÍ∞Ñ</div>
            <div id="gameTime">0s</div>
        </div>
    </div>
    
    <div class="controls">
        <button class="btn" id="startGameBtn" onclick="startNewGame()" disabled>
            Í≤åÏûÑ ÏãúÏûë (0.001 ETH)
        </button>
        <button class="btn" id="refreshBtn" onclick="refreshGameState()">
            ÏÉÅÌÉú ÏÉàÎ°úÍ≥†Ïπ®
        </button>
    </div>
    
    <div id="statusMessage" class="status-message hidden"></div>
    
    <div class="game-board board-medium" id="gameBoard">
        <!-- Game board will be generated here -->
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        // Somnia Testnet configuration
        const SOMNIA_NETWORK = {
            chainId: '0xC488',
            chainName: 'Somnia Testnet',
            nativeCurrency: {
                name: 'SLL',
                symbol: 'SLL',
                decimals: 18,
            },
            rpcUrls: ['https://dream-rpc.somnia.network/'],
            blockExplorerUrls: ['https://shannon-explorer.somnia.network/'],
        };
        
        // Contract configuration (ÏóÖÎç∞Ïù¥Ìä∏ ÌïÑÏöî)
        const CONTRACT_ADDRESS = '0x7CFf491db6f4B1f65623d25E409a48c352Cd8268'; // V2 Ïª®Ìä∏ÎûôÌä∏Î°ú ÏóÖÎç∞Ïù¥Ìä∏ ÌïÑÏöî
        const CONTRACT_ABI = [
            "function startGame(uint8 difficulty) external payable",
            "function revealTile(uint8 position) external",
            "function flagTile(uint8 position) external",
            "function getGameState() external view returns (uint8[] memory board, bool[] memory revealed, bool[] memory flagged, bool gameOver, bool won, uint8 difficulty, uint8 rows, uint8 cols)",
            "function getDifficultyConfig(uint8 difficulty) external view returns (tuple(uint8 rows, uint8 cols, uint8 mines, uint256 entryFee, uint256 winningReward))",
            "function getPlayerStats(address player) external view returns (uint256 totalScore, uint256 totalWins, uint256 easyWins, uint256 mediumWins, uint256 hardWins)",
            "event GameStarted(address indexed player, uint8 difficulty)",
            "event TileRevealed(address indexed player, uint8 position)",
            "event TileFlagged(address indexed player, uint8 position, bool flagged)",
            "event GameOver(address indexed player, bool won, uint256 score, uint8 difficulty)"
        ];
        
        let provider;
        let signer;
        let contract;
        let selectedDifficulty = 1; // Í∏∞Î≥∏Í∞í: Ï§ëÍ∏â
        let gameState = {
            board: [],
            revealed: [],
            flagged: [],
            gameOver: false,
            won: false,
            difficulty: 1,
            rows: 16,
            cols: 16
        };
        let gameStartTime = 0;
        let gameTimer;
        let isRightClick = false;
        
        const difficultyConfigs = {
            0: { name: 'Ï¥àÍ∏â', emoji: 'üü¢', rows: 9, cols: 9, mines: 10, fee: '0.0005', reward: '0.001' },
            1: { name: 'Ï§ëÍ∏â', emoji: 'üü°', rows: 16, cols: 16, mines: 40, fee: '0.001', reward: '0.003' },
            2: { name: 'Í≥†Í∏â', emoji: 'üî¥', rows: 16, cols: 30, mines: 99, fee: '0.002', reward: '0.008' }
        };
        
        async function connectWallet() {
            try {
                if (typeof window.ethereum !== 'undefined') {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [SOMNIA_NETWORK],
                    });
                    
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    await provider.send('eth_requestAccounts', []);
                    signer = provider.getSigner();
                    
                    const address = await signer.getAddress();
                    document.getElementById('walletStatus').innerHTML = `
                        <div>Ïó∞Í≤∞Îê®: ${address.slice(0, 6)}...${address.slice(-4)}</div>
                    `;
                    
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    
                    document.getElementById('startGameBtn').disabled = false;
                    
                    await updatePlayerStats();
                    await refreshGameState();
                    showMessage('ÏßÄÍ∞ëÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§!', 'success');
                } else {
                    showMessage('MetaMaskÎ•º ÏÑ§ÏπòÌï¥Ï£ºÏÑ∏Ïöî!', 'error');
                }
            } catch (error) {
                console.error('Connection error:', error);
                showMessage('ÏßÄÍ∞ë Ïó∞Í≤∞ Ïã§Ìå®: ' + error.message, 'error');
            }
        }
        
        function selectDifficulty(difficulty) {
            selectedDifficulty = difficulty;
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.difficulty-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-difficulty="${difficulty}"]`).classList.add('selected');
            
            // ÏãúÏûë Î≤ÑÌäº ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            const config = difficultyConfigs[difficulty];
            document.getElementById('startGameBtn').textContent = 
                `Í≤åÏûÑ ÏãúÏûë (${config.fee} ETH)`;
            
            // Î≥¥Îìú ÌÅ¨Í∏∞ ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏ (Í≤åÏûÑÏù¥ ÏóÜÍ±∞ÎÇò Ï¢ÖÎ£åÎêú Í≤ΩÏö∞ÏóêÎßå)
            if (!gameState.board.length || gameState.gameOver) {
                updateBoardPreview(difficulty);
            }
        }
        
        function updateBoardPreview(difficulty) {
            const board = document.getElementById('gameBoard');
            const config = difficultyConfigs[difficulty];
            
            // Î≥¥Îìú ÌÅ¥ÎûòÏä§ ÏóÖÎç∞Ïù¥Ìä∏
            board.className = 'game-board';
            if (difficulty === 0) board.classList.add('board-easy');
            else if (difficulty === 1) board.classList.add('board-medium');
            else if (difficulty === 2) board.classList.add('board-hard');
            
            board.innerHTML = '';
            
            const totalTiles = config.rows * config.cols;
            
            // Îπà ÌÉÄÏùºÎ°ú ÎØ∏Î¶¨Î≥¥Í∏∞ ÏÉùÏÑ±
            for (let i = 0; i < totalTiles; i++) {
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.style.cursor = 'default';
                board.appendChild(tile);
            }
            
            // ÌòÑÏû¨ ÎÇúÏù¥ÎèÑ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('currentDifficulty').textContent = config.name;
            document.getElementById('minesLeft').textContent = config.mines;
        }
        
        async function startNewGame() {
            try {
                showMessage('Í≤åÏûÑÏùÑ ÏãúÏûëÌïòÎäî Ï§ë...', 'loading');
                
                await refreshGameState();
                
                if (!gameState.gameOver && gameState.board.some(v => v !== 10)) {
                    showMessage('ÌòÑÏû¨ Í≤åÏûÑÏùÑ Î®ºÏ†Ä ÏôÑÎ£åÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                    return;
                }
                
                document.getElementById('startGameBtn').disabled = true;
                
                const config = difficultyConfigs[selectedDifficulty];
                const tx = await contract.startGame(selectedDifficulty, {
                    value: ethers.utils.parseEther(config.fee)
                });
                
                await tx.wait();
                
                gameStartTime = Date.now();
                startGameTimer();
                
                document.getElementById('gameInfo').style.display = 'flex';
                document.getElementById('currentDifficulty').textContent = config.name;
                
                await refreshGameState();
                showMessage('ÏÉà Í≤åÏûÑÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§! ÌÉÄÏùºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Í≥µÍ∞úÌïòÏÑ∏Ïöî.', 'success');
            } catch (error) {
                console.error('Start game error:', error);
                
                document.getElementById('startGameBtn').disabled = false;
                
                if (error.message && error.message.includes('Game already in progress')) {
                    showMessage('Í≤åÏûÑ ÏÉÅÌÉúÎ•º ÏÉàÎ°úÍ≥†Ïπ®ÌïòÎäî Ï§ë...', 'loading');
                    await refreshGameState();
                    if (gameState.gameOver) {
                        showMessage('Ïù¥Ï†Ñ Í≤åÏûÑÏù¥ Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§. Îã§Ïãú Í≤åÏûÑÏùÑ ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî.', 'info');
                    } else {
                        showMessage('ÏßÑÌñâ Ï§ëÏù∏ Í≤åÏûÑÏù¥ ÏûàÏäµÎãàÎã§. Î®ºÏ†Ä ÏôÑÎ£åÌï¥Ï£ºÏÑ∏Ïöî.', 'error');
                    }
                } else {
                    showMessage('Í≤åÏûÑ ÏãúÏûë Ïã§Ìå®: ' + error.message, 'error');
                }
            }
        }
        
        async function refreshGameState() {
            try {
                if (!contract) return;
                
                const state = await contract.getGameState();
                gameState.board = state[0].map(n => n.toNumber ? n.toNumber() : n);
                gameState.revealed = state[1];
                gameState.flagged = state[2];
                gameState.gameOver = state[3];
                gameState.won = state[4];
                gameState.difficulty = state[5];
                gameState.rows = state[6];
                gameState.cols = state[7];
                
                updateGameBoard();
                updateMinesLeft();
                
                if (gameState.gameOver) {
                    stopGameTimer();
                    if (gameState.won) {
                        showMessage('üéâ Ï∂ïÌïòÌï©ÎãàÎã§! ÏäπÎ¶¨ÌïòÏÖ®ÏäµÎãàÎã§!', 'success');
                    } else {
                        showMessage('üí• Í≤åÏûÑ Ïò§Î≤Ñ! ÏßÄÎ¢∞Î•º Î∞üÏïòÏäµÎãàÎã§.', 'error');
                    }
                    await updatePlayerStats();
                    
                    document.getElementById('startGameBtn').disabled = false;
                }
                
            } catch (error) {
                console.error('Refresh error:', error);
                showMessage('Í≤åÏûÑ ÏÉÅÌÉú ÏÉàÎ°úÍ≥†Ïπ® Ïã§Ìå®', 'error');
            }
        }
        
        async function revealTile(position) {
            try {
                if (gameState.gameOver || gameState.revealed[position] || gameState.flagged[position]) {
                    return;
                }
                
                showMessage('ÌÉÄÏùºÏùÑ Í≥µÍ∞úÌïòÎäî Ï§ë...', 'loading');
                
                const tx = await contract.revealTile(position);
                await tx.wait();
                
                await refreshGameState();
            } catch (error) {
                console.error('Reveal tile error:', error);
                showMessage('ÌÉÄÏùº Í≥µÍ∞ú Ïã§Ìå®: ' + error.message, 'error');
            }
        }
        
        async function flagTile(position) {
            try {
                if (gameState.gameOver || gameState.revealed[position]) {
                    return;
                }
                
                const tx = await contract.flagTile(position);
                await tx.wait();
                
                await refreshGameState();
            } catch (error) {
                console.error('Flag tile error:', error);
                showMessage('ÍπÉÎ∞ú ÌëúÏãú Ïã§Ìå®: ' + error.message, 'error');
            }
        }
        
        async function updatePlayerStats() {
            try {
                if (!contract || !signer) return;
                
                const address = await signer.getAddress();
                const stats = await contract.getPlayerStats(address);
                
                document.getElementById('totalScore').textContent = stats[0].toString();
                document.getElementById('totalWins').textContent = stats[1].toString();
                document.getElementById('easyWins').textContent = stats[2].toString();
                document.getElementById('mediumWins').textContent = stats[3].toString();
                document.getElementById('hardWins').textContent = stats[4].toString();
            } catch (error) {
                console.error('Stats update error:', error);
            }
        }
        
        function updateGameBoard() {
            const board = document.getElementById('gameBoard');
            const config = difficultyConfigs[gameState.difficulty];
            
            // Î≥¥Îìú ÌÅ¥ÎûòÏä§ ÏóÖÎç∞Ïù¥Ìä∏
            board.className = 'game-board';
            if (gameState.difficulty === 0) board.classList.add('board-easy');
            else if (gameState.difficulty === 1) board.classList.add('board-medium');
            else if (gameState.difficulty === 2) board.classList.add('board-hard');
            
            board.innerHTML = '';
            
            const totalTiles = gameState.rows * gameState.cols;
            
            for (let i = 0; i < totalTiles; i++) {
                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.dataset.position = i;
                
                if (gameState.flagged[i]) {
                    tile.className += ' flagged';
                    tile.textContent = 'üö©';
                } else if (gameState.revealed[i]) {
                    tile.className += ' revealed';
                    const value = gameState.board[i];
                    
                    if (value === 9) {
                        tile.className += ' mine';
                        tile.textContent = 'üí£';
                    } else if (value > 0) {
                        tile.className += ` number-${value}`;
                        tile.textContent = value.toString();
                    }
                }
                
                tile.addEventListener('click', () => {
                    if (!isRightClick) {
                        revealTile(i);
                    }
                });
                
                tile.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    flagTile(i);
                });
                
                tile.addEventListener('mousedown', (e) => {
                    isRightClick = e.button === 2;
                });
                
                board.appendChild(tile);
            }
        }
        
        function updateMinesLeft() {
            const config = difficultyConfigs[gameState.difficulty];
            const flaggedCount = gameState.flagged.filter(f => f).length;
            document.getElementById('minesLeft').textContent = Math.max(0, config.mines - flaggedCount);
        }
        
        function startGameTimer() {
            gameTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
                document.getElementById('gameTime').textContent = `${elapsed}s`;
            }, 1000);
        }
        
        function stopGameTimer() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
        }
        
        function showMessage(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${type}`;
            statusDiv.classList.remove('hidden');
            
            if (type !== 'loading') {
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 3000);
            }
        }
        
        // Ï¥àÍ∏∞Ìôî
        updateBoardPreview(selectedDifficulty);
        
        // Í≥ÑÏ†ï Î≥ÄÍ≤Ω Í∞êÏßÄ
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    document.getElementById('walletStatus').innerHTML = '<button class="btn" onclick="connectWallet()">Connect Wallet</button>';
                    document.getElementById('startGameBtn').disabled = true;
                } else {
                    location.reload();
                }
            });
        }
    </script>
</body>
</html>